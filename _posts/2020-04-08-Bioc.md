---
layout: post
title: "Bioconductor-GitHub Package Sync"
description: "Bioconductor-GitHub Package Sync"
date: 2020-04-08 17:46:41 -0300
categories: Bioc
by: 'Daniela Cassol'
icon: 'book'
questions:
  - image: "bioconductor.jpg"
---

The following instructions are from [here](https://gist.github.com/tgirke/972f78e6bd1684319f5a6f129a466d78).
This tutorial shows how to maintain and sync R packages to both GitHub and Bioconductor's [git source control system](http://bioconductor.org/developers/how-to/git/).

* * *


## Table of Content

1. [Clone and configure new repos instance to local](#clone-conf)
2. [Steps after new Bioc release](#bioc)
3. [Commit and push your work](#commit-push)
4. [Useful utilities](#useful)

* * *

<div id='clone-conf'/>


## 1. Clone and configure new repos instance to local

Instructions adopted from [here](http://master.bioconductor.org/developers/how-to/git/maintain-github-bioc/)

Clone repos from GitHub

```sh
git clone https://github.com/<developer>/<MyPackage>.git
cd MyPackage
```
Configure the “remotes” of the GitHub clone

```sh
git remote add upstream git@git.bioconductor.org:packages/<MyPackage>.git
```

Fetch content from Bioc/upstream

```sh
git fetch upstream 
git fetch --all 
```
<div id='bioc'/>

## 2. Steps after new Bioc release

The following creates first a backup/freezed copy of the previous master branch; then fetches the new release branch created by Bioc; and syncs any changes in upstream/Bioc and origin/GitHub with local master/devel instance.  

```sh
git checkout master
git fetch upstream # Fetch content from Bioc/upstream
git checkout -b RELEASE_3_8 upstream/RELEASE_3_8 # Checkout new branch with name and tracking from Bioc (here RELEASE_3_8)
git push -u origin RELEASE_3_8 # Push new branch to GitHub; then repeat for other missing branches if any
git checkout master
git pull upstream master # Sync with new master on Bioc
git pull origin master # Sync with GitHub
git push origin master # push to github
```

<div id='commit-push'/>

## 3. Commit and push your work

The following instructions are from [here](http://bioconductor.org/developers/how-to/git/push-to-github-bioc/). If this is the first sync of a GitHub/Bioc repository, follow the instructions in the [First time sync](#first-time-sync) section first.

### 3.1. Do some work in master (devel) branch 

```sh
git checkout master # Switch to master/developer branch 
git pull upstream master # Sync with Bioc
git pull origin master # Sync with GitHub
## -> do coding work here. If more complex, create a temp branch first
git commit -am "some meaningful message"
git push origin master # push to github
git push upstream master # push to Bioc
```

### 3.2. If necessary make changes to release branch 

Example for RELEASE_3_8:

```sh
git checkout RELEASE_3_8 # Switch to release branch 
git pull upstream RELEASE_3_8 # sync with Bioc
git pull origin RELEASE_3_8 # Sync with GitHub
## -> do coding work here. If more complex, create a temp branch first
git commit -am "some meaningful message"
git push origin RELEASE_3_8 # push to github
git push upstream RELEASE_3_8 # push to Bioc
```
<div id='useful'/>

## 4. Useful utilities

Clone package from Bioconductor (e.g. to check updates)
```sh
git clone git@git.bioconductor.org:packages/<MyPackage>
```

Check differences among two directories with basic Linux `diff` command 
```sh
diff -r --exclude=".git" dir1/ dir2/
diff -qr  dir1/ dir2/ ##show only the files name
```
Review changes prior to commit and recent commits
```sh
git diff    
git log      
```

Each commit pushed to the Bioconductor repository should build and check without errors or warnings
```sh
R CMD build MyPackage
R CMD check MyPackage_1.22.3.tar.gz
```
To check that remotes are set up properly, run the command inside your local machine’s clone.
```sh
git remote -v
# which should produce the result (where <USER> is your GitHub username):

origin  git@github.com:<USER>/MyPackage.git (fetch)
origin  git@github.com:<USER>/MyPackage.git (push)
upstream    git@git.bioconductor.org:packages/MyPackage.git (fetch)
upstream    git@git.bioconductor.org:packages/MyPackage.git (push)
```
(Alternative) When changes are more elaborate, best practice is to use a local branch for development.
```sh
git checkout master
git checkout -b feature-my-feature

## multiple rounds of edit, add, commit
## Merge the local branch to master when the feature is ‘complete’.
git checkout master
git merge feature-my-feature
```
Delete branch locally
```sh
git branch -d <branch_name>
```

Renaming a branch [IMAGE](https://gist.github.com/dcassol/b8cf9ae6c1b375d88599d6edaca43c0a#file-yebyr-jpg).

Code from [here](https://gist.github.com/dcassol/b8cf9ae6c1b375d88599d6edaca43c0a#file-yebyr-jpg).
```sh
# Rename the local branch to the new name
git branch -m <old_name> <new_name>

# Delete the old branch on remote - where <remote> is, for example, origin
git push <remote> --delete old_name

# Push the new branch to remote
git push <remote> new_name

# Reset the upstream branch for the new_name local branch
git push <remote> -u new-name
```

What is the relationship between the origin and upstream remote? Info from [here](https://bioconductor.org/developers/how-to/git/faq/)

In git origin is just the default name for a remote from which a repository was originally cloned. It might equally have been called by another name. We recommend that origin be set to the developers GitHub repository = master.
Similarly, upstream is the name for a remote which is hosted on the Bioconductor server.
It is important that all the changes/updates you have on your origin are equal to upstream, in other words, you want these two remotes to be in sync.
[Image](https://gist.github.com/dcassol/b8cf9ae6c1b375d88599d6edaca43c0a/raw/e2cfad722abbdbfbfc88900d7624334464fcdcf7/github-bioc-relationship.png) explaining GitHub and Bioconductor relationship for a developer.

### 4.1. Helpful links

Adding a new SSH key to your GitHub account: info [here](https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/)
